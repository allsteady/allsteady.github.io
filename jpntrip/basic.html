<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>GMaps.js &mdash; Basic</title>
	<link rel="stylesheet" type="text/css" href="examples.css" />
	<link rel="stylesheet" href="http://code.jquery.com/mobile/git/jquery.mobile-git.css">
	<link rel="stylesheet" href="http://twitter.github.com/bootstrap/1.3.0/bootstrap.css" />

	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/mobile/git/jquery.mobile-git.js"></script>
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true&laguage=ko"></script>
	<script type="text/javascript" src="./libs/gmaps.js"></script>
	<script type="text/javascript" src="./libs/app.js"></script>
	<script type="text/javascript" src="./libs/infos.json"></script>
	<script type="text/javascript">
		var map;
		$( document ).ready(function(){
			googleMap = new GMaps({
					el: '#map',
					lat: 43.067892,
					lng: 141.350591,
					zoomControl : true,
					zoomControlOpt: {
					style : 'LARGE',
					position: 'TOP_LEFT'
				},
				panControl : false,
				streetViewControl : false,
				mapTypeControl: false,
				overviewMapControl: false
			});
			window.googleMap = googleMap;
		}).on("vclick", "#searchBtn", function ( event ) {
			var $startPos = $("#startPos"),
				$destPos = $("#endPos"),
				startPos = infos[ $startPos.val() ],
				destPos = infos[ $destPos.val() ];


			// console.log (" startPos [ name %s, lat %s, lng :%s ]",startPos.name, parseFloat( startPos.lat ), parseFloat( startPos.lng ) );
			// console.log (" destPos [ name %s, lat %s, lng :%s ]", destPos.name, parseFloat( destPos.lat ), parseFloat( destPos.lng ) );
			window.googleMap.cleanRoute()
			window.googleMap.drawRoute({
				origin: [ parseFloat( startPos.lat ), parseFloat( startPos.lng )],
				destination: [ parseFloat( destPos.lat ) , parseFloat( destPos.lng )],
				travelMode: 'walking',
				strokeColor: '#131540',
				strokeOpacity: 0.6,
				strokeWeight: 6,
				callback : function ( e ) {
					var routeInfos,
						panel = $("#configPanel");
					console.log (" [RUN] : callback..............");
					if ( e.legs && e.legs.length > 0 ) {
						console.log (" [get informations] : callback..............");
						routeInfos = e.legs [ 0 ];
						panel.find("#startAddr").text( routeInfos.start_address );
						panel.find("#endAddr").text( routeInfos.end_address );
						panel.find("#distance").text( routeInfos.distance.text );
						panel.find("#duration").text( routeInfos.duration.text );

					}
				}
			});
			window.googleMap.setCenter(parseFloat( startPos.lat ), parseFloat( startPos.lng ));



			// window.googleMap.drawRoute({
			// 	origin: [43.067892, 141.350591],
			// 	destination: [42.787599, 141.681436],
			// 	travelMode: 'transit',
			// 	strokeColor: '#131540',
			// 	strokeOpacity: 0.6,
			// 	strokeWeight: 6
			// });
		});

	</script>
</head>
<body>
	<div data-role="page" id="fastscroll-demo" data-fit-page-to-window="true">
		<div data-role="header" data-position="fixed">
			<!--
				<a href="#frontPage" class="hide-loading ui-btn-left" data-icon="back">Back</a>
			-->
			<h1>훗카이도 ( 北海道 ) 여행</h1>
			<a href="#configPanel" id="configBtnH" class="hide-loading ui-btn-right" data-icon="info">Info</a>
		</div><!-- header -->
		<div class="content" data-role="content" data-scroll="y">
			<div id="map" style="heigh: 50%;"></div>
			<div data-role="fieldcontain">
				<label for="startPos" class="select">출발지</label>
				<select name="startPos" id="startPos" >

					<option value="airport">치토세 공항</option>
					<option value="hotel">쉐라톤 호텔 (in 삿뽀로)</option>
					<optgroup label="삿뽀루">
						<option value="sapporo_station">삿뽀루 역</option>
					</optgroup>
					<optgroup label="오타루">
						<option value="otaru_station">오타루역</option>
					</optgroup>

				</select>
			</div>

			<div data-role="fieldcontain">
				<label for="endPos" class="select">도착지</label>
				<select name="endPos" id="endPos" >
					<option value="airport">치토세 공항</option>
					<option value="hotel">쉐라톤 호텔 (in 삿뽀로)</option>
					<optgroup label="삿뽀루">
						<option value="sapporo_station">삿뽀루 역</option>
					</optgroup>
					<optgroup label="오타루">
						<option value="otaru_station">오타루역</option>
					</optgroup>
				</select>
			</div>
			<div data-role="fieldcontain">
				<label for="travelMode" class="select">이동수단</label>
				<select name="travelMode" id="travelMode" >
					<option value="walking">WALKING</option>
					<option value="driving">DRIVING</option>
					<option value="transit">TRANSIT</option>mv
				</select>
			</div>

  			<a id="searchBtn"  data-role="button" data-theme="c" data-icon="search" data-inline="true">Search</a>

		</div><!-- content -->
		<div data-role="panel" id="configPanel" data-theme="b">	
			<div class="panel-content">
			<h3>설정</h3>
			<p>
				도착지 주소 : <span id="startAddr"> </span>
			</p>
			<br>
			<p>
				출발지 주소 : <span id="endAddr"> </span>
			</p>
			<br>
			<p>
				거리 : <span id="distance"> </span><br>
				소요시간 : <span id="duration"> </span>
			</p>
			
			<a href="#demo-links" data-rel="close" data-role="button" data-theme="c" data-icon="delete" data-inline="true">Close panel</a>
			</div><!-- /content wrapper for padding -->
		</div><!-- /defaultpanel -->
	</div><!-- page -->
</body>
</html>
